import{r as R,a as x,b as T,o as v,c as g,d as n,t as p,u as Y,e as y,w as b,F as E,f as O,g as G,n as Z,T as X,h as k,i as K,j as C,s as $,k as ee,l as te}from"./bailianClient-Df5eaemu.js";const P=[{id:"weekend-plan",title:"周末突然空下来半天，你最可能怎么安排？",description:"这个选择能反映你对城市资源密度与生活松弛度的偏好。",weight:1.2,options:[{id:"weekend-citywalk",label:"去新开的街区 citywalk，顺便打卡两家店",vector:{paceFast:8,foodDiversity:9,transitPublic:8,careerTech:7}},{id:"weekend-outdoor",label:"去公园或近郊徒步，尽量待在自然里",vector:{naturePreference:10,paceFast:3,climateWarm:7,familyFriendly:7}},{id:"weekend-home",label:"在家做饭看书，恢复精力",vector:{familyFriendly:8,budgetHigh:4,paceFast:3,climateWarm:6}},{id:"weekend-friends",label:"约朋友喝咖啡聊天，不追求太满行程",vector:{familyFriendly:7,paceFast:5,foodDiversity:7,transitPublic:7}}]},{id:"morning-commute",title:"工作日早上出门时，你最在意哪件事？",description:"通勤偏好会影响你和城市交通结构的契合度。",weight:1.1,options:[{id:"commute-efficient",label:"通勤可预期，换乘少、准时到",vector:{transitPublic:9,paceFast:8,careerTech:7}},{id:"commute-short",label:"最好 20 分钟内，步行/骑行也能搞定",vector:{transitPublic:8,naturePreference:8,paceFast:5}},{id:"commute-drive",label:"更习惯自驾，路况和停车友好更重要",vector:{transitPublic:4,budgetHigh:7,paceFast:6,familyFriendly:7}},{id:"commute-flex",label:"时间弹性大，不想被固定通勤绑定",vector:{paceFast:3,naturePreference:9,climateWarm:6,careerTech:5}}]},{id:"rent-priority",title:"租房/买房看房时，你第一眼最看重什么？",description:"这个问题会显著影响居住成本与城市形态匹配。",weight:1.3,options:[{id:"rent-location",label:"离工作机会和核心商圈近，效率优先",vector:{careerTech:10,paceFast:8,budgetHigh:9,transitPublic:8}},{id:"rent-value",label:"面积和性价比，长期住得舒服",vector:{budgetHigh:4,familyFriendly:9,paceFast:4,naturePreference:6}},{id:"rent-community",label:"社区安静、配套稳定、生活省心",vector:{familyFriendly:10,paceFast:4,transitPublic:7,climateWarm:6}},{id:"rent-view",label:"窗外最好有绿地或水景，环境感受最重要",vector:{naturePreference:10,climateWarm:7,familyFriendly:8,paceFast:3}}]},{id:"dinner-style",title:"平日下班后，你更常见的晚餐状态是？",description:"饮食与夜生活偏好能反映你对城市活力的需求。",weight:1,options:[{id:"dinner-explore",label:"经常探索新店，愿意为体验买单",vector:{foodDiversity:10,paceFast:7,budgetHigh:8}},{id:"dinner-stable",label:"固定几家熟悉的店，稳定最重要",vector:{familyFriendly:8,foodDiversity:6,paceFast:5,budgetHigh:5}},{id:"dinner-homecook",label:"以自己做饭为主，偶尔外卖",vector:{familyFriendly:8,budgetHigh:4,paceFast:4,climateWarm:6}},{id:"dinner-light",label:"轻食加运动，保持规律生活",vector:{naturePreference:8,paceFast:6,climateWarm:6,familyFriendly:7}}]},{id:"social-style",title:"朋友临时约你晚上出门，你通常会？",description:"社交响应方式会影响对城市节奏和文化密度的判断。",weight:1.1,options:[{id:"social-go",label:"说走就走，活动越丰富越好",vector:{paceFast:9,foodDiversity:8,transitPublic:7,careerTech:8}},{id:"social-plan",label:"看地点和通勤成本，再决定是否出门",vector:{transitPublic:8,paceFast:6,familyFriendly:7}},{id:"social-daytime",label:"更偏好周末白天见，晚上想留给自己",vector:{familyFriendly:8,paceFast:4,naturePreference:7}},{id:"social-small",label:"小范围安静聚会，比热闹更重要",vector:{naturePreference:7,familyFriendly:8,paceFast:3,climateWarm:6}}]},{id:"weather-day",title:"遇到连续几天阴雨或闷热，你最在意什么？",description:"日常天气耐受度决定长期体感和心情稳定性。",weight:1.05,options:[{id:"weather-commute",label:"通勤别失控，效率不能掉太多",vector:{transitPublic:9,paceFast:8,climateWarm:6}},{id:"weather-indoor",label:"室内舒适和空气质量要稳定",vector:{familyFriendly:8,climateWarm:7,budgetHigh:6}},{id:"weather-outdoor",label:"希望天气不影响户外活动安排",vector:{naturePreference:9,climateWarm:8,paceFast:5}},{id:"weather-rhythm",label:"只要生活节奏不被打断就行",vector:{paceFast:8,climateWarm:6,careerTech:7}}]},{id:"career-3years",title:"未来 3 年，你最希望哪方面变化更明显？",description:"中期目标能帮助判断城市发展机会与生活承载力。",weight:1.35,options:[{id:"career-jump",label:"职业跃迁，进入更大平台与更强团队",vector:{careerTech:10,paceFast:8,budgetHigh:8,transitPublic:8}},{id:"career-steady",label:"工作稳定增长，生活质量稳步提升",vector:{familyFriendly:9,budgetHigh:6,paceFast:5,naturePreference:6}},{id:"career-flex",label:"时间更自主，能远程或自由安排工作",vector:{naturePreference:9,paceFast:3,careerTech:5,climateWarm:7}},{id:"career-diverse",label:"行业与文化都多元，视野持续打开",vector:{foodDiversity:9,transitPublic:8,careerTech:8,paceFast:7}}]},{id:"end-of-day",title:"理想的一天结束时，你最想感受到什么？",description:"终局感受通常最能代表你真正的长期居住诉求。",weight:1.25,options:[{id:"day-achievement",label:"高效充实，今天推进了很多关键事",vector:{paceFast:9,careerTech:9,transitPublic:7}},{id:"day-relax",label:"内心松弛，生活和工作都不过载",vector:{naturePreference:9,familyFriendly:8,paceFast:3,climateWarm:7}},{id:"day-balance",label:"效率和生活感并存，状态长期可持续",vector:{paceFast:7,familyFriendly:8,naturePreference:7,careerTech:7,budgetHigh:6}},{id:"day-family",label:"和家人/伴侣有高质量相处时间",vector:{familyFriendly:10,paceFast:4,budgetHigh:6,climateWarm:6}}]}],z=[{name:"杭州",profile:{climateWarm:7,paceFast:7,budgetHigh:7,careerTech:8,naturePreference:8,transitPublic:8,foodDiversity:8,familyFriendly:8},traits:["数字经济强","山水与城市共存","生活便利度高"]},{name:"成都",profile:{climateWarm:7,paceFast:5,budgetHigh:5,careerTech:6,naturePreference:7,transitPublic:7,foodDiversity:9,familyFriendly:8},traits:["生活节奏友好","餐饮文化强","长期居住舒适"]},{name:"深圳",profile:{climateWarm:9,paceFast:9,budgetHigh:8,careerTech:10,naturePreference:6,transitPublic:8,foodDiversity:8,familyFriendly:6},traits:["创新产业密集","机会窗口大","城市效率高"]},{name:"上海",profile:{climateWarm:5,paceFast:10,budgetHigh:10,careerTech:9,naturePreference:4,transitPublic:10,foodDiversity:10,familyFriendly:6},traits:["国际化程度高","公共交通成熟","职业机会密集"]},{name:"苏州",profile:{climateWarm:6,paceFast:6,budgetHigh:7,careerTech:7,naturePreference:8,transitPublic:8,foodDiversity:7,familyFriendly:9},traits:["宜居稳定","制造与新兴产业并重","家庭友好"]},{name:"厦门",profile:{climateWarm:9,paceFast:4,budgetHigh:7,careerTech:5,naturePreference:9,transitPublic:6,foodDiversity:7,familyFriendly:8},traits:["气候舒适","滨海生活感强","节奏相对平和"]},{name:"青岛",profile:{climateWarm:6,paceFast:5,budgetHigh:6,careerTech:6,naturePreference:8,transitPublic:7,foodDiversity:8,familyFriendly:8},traits:["海滨环境优势","宜居属性好","生活成本相对均衡"]},{name:"昆明",profile:{climateWarm:8,paceFast:3,budgetHigh:4,careerTech:4,naturePreference:10,transitPublic:5,foodDiversity:7,familyFriendly:8},traits:["四季体感友好","自然资源丰富","慢节奏生活"]},{name:"广州",profile:{climateWarm:8,paceFast:8,budgetHigh:8,careerTech:8,naturePreference:6,transitPublic:9,foodDiversity:9,familyFriendly:7},traits:["商贸与产业并重","交通网络成熟","饮食文化多样"]},{name:"宁波",profile:{climateWarm:7,paceFast:6,budgetHigh:6,careerTech:6,naturePreference:8,transitPublic:7,foodDiversity:7,familyFriendly:8},traits:["产业基础扎实","海港城市优势","生活平衡感较好"]},{name:"南京",profile:{climateWarm:6,paceFast:7,budgetHigh:7,careerTech:7,naturePreference:7,transitPublic:8,foodDiversity:8,familyFriendly:8},traits:["教育资源集中","历史与现代融合","综合平衡能力强"]},{name:"武汉",profile:{climateWarm:7,paceFast:7,budgetHigh:6,careerTech:7,naturePreference:6,transitPublic:8,foodDiversity:8,familyFriendly:7},traits:["区域中心城市","产业结构多元","通勤网络较完善"]}],J={climateWarm:"气候舒适度偏好",paceFast:"生活节奏偏好",budgetHigh:"可接受居住成本",careerTech:"职业机会诉求",naturePreference:"自然环境偏好",transitPublic:"公共交通依赖度",foodDiversity:"饮食/文化多样性",familyFriendly:"长期安居与家庭友好"},M=Object.keys(J);function V(){return M.reduce((e,o)=>(e[o]=0,e),{})}function re(e,o){return e.map((r,a)=>{const i=o[a],s=r.options.find(c=>c.id===i);return{questionId:r.id,questionTitle:r.title,optionId:(s==null?void 0:s.id)??null,optionLabel:(s==null?void 0:s.label)??"未作答",weight:r.weight,vector:(s==null?void 0:s.vector)??{}}})}function ae(e,o){const r=V(),a=V();e.forEach((s,c)=>{const d=o[c],m=s.options.find(f=>f.id===d);m&&Object.entries(m.vector).forEach(([f,w])=>{r[f]+=w*s.weight,a[f]+=s.weight})});const i=V();return M.forEach(s=>{const c=a[s];i[s]=c>0?r[s]/c:5}),{preferenceVector:i,dimensionWeights:a}}function ie(e,o,r){let a=0,i=0;M.forEach(d=>{const m=Math.max(r[d],.6),f=e[d]-o[d];a+=m*f*f,i+=m*100});const s=Math.sqrt(a)/Math.sqrt(i),c=Math.round((1-s)*100);return Math.min(100,Math.max(0,c))}function ne(e,o,r){return M.map(a=>{const i=Math.abs(e[a]-o[a]);return{label:J[a],sortScore:i-r[a]*.12}}).sort((a,i)=>a.sortScore-i.sortScore).slice(0,3).map(a=>a.label)}function se(e,o,r){const a=ne(e.profile,o,r);return`${e.name}与您在${a.join("、")}上更契合，同时在生活效率与长期居住稳定性之间表现均衡。`}function oe(e){return e.map((o,r)=>`${r+1}. ${o.questionTitle} -> ${o.optionLabel}`)}function le({questions:e,answerIds:o,cities:r}){const a=re(e,o),i=oe(a),{preferenceVector:s,dimensionWeights:c}=ae(e,o),d=r.map(F=>({...F,score:ie(F.profile,s,c)})).sort((F,S)=>S.score-F.score),m=d[0],f=d.slice(0,3),w=se(m,s,c);return{topCity:m,topThree:f,scoredCities:d,preferenceVector:s,dimensionWeights:c,answerSummary:a,summaryLines:i,localInsight:w}}function D(e){return Number.isFinite(e)?Math.max(0,Math.min(100,Math.round(e))):0}function ce(e){return["你是城市居住匹配分析专家，请根据用户日常生活答卷，推断最适合长期居住的城市。","请严格遵守：只能从候选城市列表里选择。","请只输出 JSON，不要输出其他说明。","JSON 模板：",JSON.stringify({topCity:{name:"候选城市名",score:"0-100 整数"},topThree:[{name:"候选城市名",score:0},{name:"候选城市名",score:0},{name:"候选城市名",score:0}],insight:"150 字以内，解释推荐原因。",cityLifeAdvice:"80 字以内，给出落地建议（居住片区、通勤、生活方式）。"},null,2),"用户答卷结构化数据：",JSON.stringify(e.answerSummary,null,2),"用户答卷摘要文本：",e.summaryLines.join(`
`),"用户偏好向量（0-10）：",JSON.stringify(e.preferenceVector,null,2),"候选城市列表：",JSON.stringify(e.candidateCities,null,2),"本地模型候选 Top3（可参考）：",JSON.stringify(e.localTopThree,null,2)].join(`

`)}function ue(e,o,r){var S,L,W;const a=new Set(o.map(u=>u.name)),i=u=>{var _,l;return a.has(u)?u:((_=r[0])==null?void 0:_.name)??((l=o[0])==null?void 0:l.name)??"杭州"},s=r.slice(0,3).map(u=>({name:i(u.name),score:D(u.score)})),c={topCity:s[0]??{name:"杭州",score:0},topThree:s,insight:"基于当前答卷，你更适合在效率与生活质量之间平衡更好的城市。",cityLifeAdvice:"建议先在通勤半径内试住 1-3 个月，再决定长期定居。"};if(!e||typeof e!="object")return c;const d=[],m=new Set;(Array.isArray(e.topThree)?e.topThree:[]).forEach(u=>{const _=i(u==null?void 0:u.name);m.has(_)||(m.add(_),d.push({name:_,score:D(u==null?void 0:u.score)}))}),s.forEach(u=>{d.length>=3||m.has(u.name)||(d.push(u),m.add(u.name))});const w=i((S=e==null?void 0:e.topCity)==null?void 0:S.name),F=D((L=e==null?void 0:e.topCity)==null?void 0:L.score);return{topCity:{name:w,score:F||((W=d[0])==null?void 0:W.score)||0},topThree:d.slice(0,3),insight:typeof e.insight=="string"&&e.insight.trim()?e.insight.trim():c.insight,cityLifeAdvice:typeof e.cityLifeAdvice=="string"&&e.cityLifeAdvice.trim()?e.cityLifeAdvice.trim():c.cityLifeAdvice}}async function de(e,o={}){const r=await R({systemPrompt:"你是资深城市生活顾问。必须只输出 JSON，不要输出额外文本。",userPrompt:ce(e),timeoutMs:o.timeoutMs??18e3,temperature:.2});return ue(r,e.candidateCities??[],e.localTopThree??[])}const me={class:"page"},pe={class:"app-shell","aria-live":"polite"},fe={class:"app-header"},ye={class:"header-desc"},he={key:0,class:"card is-visible","aria-label":"问卷区域"},ve={class:"card-top"},ge={class:"progress-meta"},be={class:"question-title"},Fe={class:"question-description"},_e={class:"actions"},Te={key:1,class:"card result-card","aria-label":"分析结果区域"},Pe={key:0,class:"loading-state"},we={key:1,class:"result-state"},ke={class:"result-source-wrap"},Se={class:"result-city"},Ce={class:"result-score"},Le={class:"result-insight"},We={class:"result-advice"},He={class:"result-tags"},Ae={class:"rank-wrap"},Ne={class:"top-list"},xe={class:"top-score"},Me={class:"summary-wrap"},Ie={class:"summary-list"},Ee={__name:"App",setup(e){const o=x("survey"),r=x(0),a=x(Array.from({length:P.length},()=>null)),i=x(null),s=P.length,c=C(()=>P[r.value]),d=C(()=>r.value===P.length-1),m=C(()=>a.value[r.value]!==null),f=C(()=>{const l=r.value+1;return Math.round(l/P.length*100)}),w=C(()=>`问题 ${r.value+1} / ${P.length}`);function F(l){a.value[r.value]=l}function S(){r.value>0&&(r.value-=1)}function L(l){return{answerSummary:l.answerSummary,summaryLines:l.summaryLines,preferenceVector:l.preferenceVector,candidateCities:z.map(t=>({name:t.name,profile:t.profile,traits:t.traits})),localTopThree:l.topThree.map(t=>({name:t.name,score:t.score,traits:t.traits}))}}function W(l,t){return{source:"ai",topCity:l.topCity,topThree:l.topThree,insight:l.insight,cityLifeAdvice:l.cityLifeAdvice,summaryLines:t.summaryLines}}async function u(){if(!m.value){$("请先选择一个选项");return}if(!d.value){r.value+=1;return}o.value="analyzing";const l=le({questions:P,answerIds:a.value,cities:z});try{const t=await de(L(l),{timeoutMs:18e3});i.value=W(t,l)}catch(t){i.value={source:"local",topCity:{name:l.topCity.name,score:l.topCity.score},topThree:l.topThree.map(H=>({name:H.name,score:H.score})),insight:l.localInsight,cityLifeAdvice:"深度解析暂不可用，建议先按 Top3 城市做 1-3 个月短租试住验证。",summaryLines:l.summaryLines},$((t==null?void 0:t.message)||"深度匹配失败，已切换为本地分析结果")}o.value="result"}function _(){r.value=0,a.value=Array.from({length:P.length},()=>null),i.value=null,o.value="survey"}return(l,t)=>{const H=T("van-progress"),j=T("van-radio"),q=T("van-cell"),B=T("van-cell-group"),Q=T("van-radio-group"),I=T("van-button"),U=T("van-loading"),A=T("van-tag");return v(),g("div",me,[t[11]||(t[11]=n("div",{class:"bg-orb bg-orb-left","aria-hidden":"true"},null,-1)),t[12]||(t[12]=n("div",{class:"bg-orb bg-orb-right","aria-hidden":"true"},null,-1)),n("main",pe,[n("header",fe,[t[0]||(t[0]=n("p",{class:"header-tag"},"Daily Life Relocation Survey",-1)),t[1]||(t[1]=n("h1",null,"通过生活习惯，推断最适合你的居住城市",-1)),n("p",ye," 回答 "+p(Y(s))+" 个日常问题，系统会先做结构化匹配，再对答卷进行深度解析并给出最终推荐。 ",1)]),o.value==="survey"?(v(),g("section",he,[n("div",ve,[n("div",ge,[n("span",null,p(w.value),1),n("span",null,p(f.value)+"%",1)]),y(H,{percentage:f.value,"show-pivot":!1,"stroke-width":8,color:"linear-gradient(90deg, #0f8a63, #43b78b)","track-color":"rgba(40, 95, 75, 0.13)"},null,8,["percentage"])]),y(X,{name:"fade-slide",mode:"out-in"},{default:b(()=>[(v(),g("div",{key:c.value.id,class:"question-wrap"},[n("h2",be,p(c.value.title),1),n("p",Fe,p(c.value.description),1),y(Q,{"model-value":a.value[r.value],class:"option-group","onUpdate:modelValue":F},{default:b(()=>[y(B,{inset:"",class:"option-cell-group"},{default:b(()=>[(v(!0),g(E,null,O(c.value.options,h=>(v(),G(q,{key:h.id,class:Z(["option-cell",{"is-selected":a.value[r.value]===h.id}]),clickable:"",title:h.label,onClick:N=>F(h.id)},{"right-icon":b(()=>[y(j,{name:h.id,"checked-color":"#0f8a63"},null,8,["name"])]),_:2},1032,["class","title","onClick"]))),128))]),_:1})]),_:1},8,["model-value"])]))]),_:1}),n("div",_e,[y(I,{block:"",class:"btn btn-secondary",disabled:r.value===0,onClick:S},{default:b(()=>[...t[2]||(t[2]=[k(" 上一步 ",-1)])]),_:1},8,["disabled"]),y(I,{block:"",class:"btn btn-primary",disabled:!m.value,onClick:u},{default:b(()=>[k(p(d.value?"汇总并开始匹配":"下一步"),1)]),_:1},8,["disabled"])])])):(v(),g("section",Te,[o.value==="analyzing"?(v(),g("div",Pe,[y(U,{color:"#0f8a63",size:"26px"}),t[3]||(t[3]=n("p",null,"正在汇总答卷并生成匹配结果...",-1))])):i.value?(v(),g("div",we,[n("div",ke,[y(A,{color:i.value.source==="ai"?"#e8f7f0":"#fff3e3","text-color":i.value.source==="ai"?"#1b6a50":"#9c5d00",round:""},{default:b(()=>[k(p(i.value.source==="ai"?"深度匹配结果":"本地规则兜底结果"),1)]),_:1},8,["color","text-color"])]),t[10]||(t[10]=n("p",{class:"result-prefix"},"最终推荐城市",-1)),n("h2",Se,p(i.value.topCity.name),1),n("p",Ce,"综合匹配度："+p(i.value.topCity.score)+"%",1),n("p",Le,p(i.value.insight),1),n("p",We,p(i.value.cityLifeAdvice),1),n("div",He,[y(A,{type:"primary",color:"#e9f7f1","text-color":"#1a6a4f"},{default:b(()=>[...t[4]||(t[4]=[k("生活习惯映射",-1)])]),_:1}),y(A,{type:"primary",color:"#e9f7f1","text-color":"#1a6a4f"},{default:b(()=>[...t[5]||(t[5]=[k("结构化偏好拟合",-1)])]),_:1}),y(A,{type:"primary",color:"#e9f7f1","text-color":"#1a6a4f"},{default:b(()=>[...t[6]||(t[6]=[k("语义化结论生成",-1)])]),_:1})]),n("div",Ae,[t[7]||(t[7]=n("h3",null,"Top 3 匹配城市",-1)),n("ul",Ne,[(v(!0),g(E,null,O(i.value.topThree,(h,N)=>(v(),g("li",{key:h.name,class:"top-item"},[n("span",null,p(N+1)+". "+p(h.name),1),n("span",xe,p(h.score)+"%",1)]))),128))])]),n("div",Me,[t[8]||(t[8]=n("h3",null,"答卷汇总（已用于深度解析）",-1)),n("ul",Ie,[(v(!0),g(E,null,O(i.value.summaryLines,(h,N)=>(v(),g("li",{key:`${h}-${N}`,class:"summary-item"},p(h),1))),128))])]),y(I,{block:"",class:"btn btn-primary btn-block",onClick:_},{default:b(()=>[...t[9]||(t[9]=[k(" 重新测评 ",-1)])]),_:1})])):K("",!0)]))])])}}};ee(Ee).use(te).mount("#app");
